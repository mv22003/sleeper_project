<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sleeper Dynasty History</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen p-6">

    <div class="max-w-2xl mx-auto bg-white shadow-xl rounded-xl p-6">

        <h1 class="text-3xl font-bold text-center mb-4 text-indigo-600">
            Sleeper Dynasty History Viewer
        </h1>

        <!-- Username Input -->
        <label class="block font-semibold mb-1">Sleeper Username:</label>
        <input id="username" 
               class="w-full border p-2 rounded mb-4" 
               placeholder="manuelvv13">

        <!-- League ID Input -->
        <label class="block font-semibold mb-1">League ID:</label>
        <input id="league_id" 
               class="w-full border p-2 rounded mb-4" 
               placeholder="Enter Sleeper League ID">

        <button onclick="loadHistory()"
            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 rounded">
            Load League History
        </button>

        <div id="output" class="mt-6"></div>

    </div>

<script>
async function loadHistory() {
    const user = document.getElementById("username").value;
    const leagueId = document.getElementById("league_id").value;

    const output = document.getElementById("output");
    output.innerHTML = "<p class='text-gray-500'>Loading...</p>";

    const url = `http://127.0.0.1:8000/league_history/${leagueId}/${user}`;

    const res = await fetch(url);
    const data = await res.json();

    if (data.error) {
        output.innerHTML = `<p class='text-red-500 font-semibold'>${data.error}</p>`;
        return;
    }

    // Render pretty UI
    let html = `
        <h2 class="text-xl font-bold mb-2 text-indigo-700">Dynasty History for ${user}</h2>
        <div class="space-y-4">
    `;

    // Iterate over seasons
    const seasons = Object.keys(data.history).sort().reverse();
    
    seasons.forEach(season => {
        const entry = data.history[season];
        const roster = entry.roster;

        html += `
            <div class="bg-white border rounded-lg p-4 shadow">
                <h3 class="text-lg font-semibold text-indigo-600">Season ${season}</h3>
                <p class="text-sm text-gray-500 mb-2">League ID: ${entry.league_id}</p>
        `;

        if (roster && roster.players) {
            html += `
                <p class="font-semibold mb-1">Players:</p>
                <ul class="list-disc ml-6">
            `;
            roster.players.forEach(pid => {
                html += `<li>${pid}</li>`;
            });
            html += `</ul>`;
        } else {
            html += `<p class="text-gray-500 italic">No roster found for this season.</p>`;
        }

        html += `</div>`;
    });

    html += `</div>`;
    output.innerHTML = html;
}
</script>

</body>
</html>
