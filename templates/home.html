<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <!-- Page title shown in browser tab -->
    <title>Sleeper Dynasty Analyzer</title>

    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-zinc-950 min-h-screen flex items-center justify-center p-6">

<!-- Vertical wrapper -->
<div class="w-full max-w-xl text-center">

    <!-- Logo placeholder -->
    <div class="mx-auto mb-4 w-16 h-16
                rounded-2xl
                border-2 border-dashed border-white/20
                flex items-center justify-center
                text-white/30 text-xs">
        LOGO
    </div>

    <!-- Title -->
    <h1 class="text-3xl font-bold mb-2 text-indigo-400">
        Dynasty Football Analyzer
    </h1>

    <!-- Subtitle -->
    <p class="text-gray-400 mb-8">
        Discover how good of a dynasty football player you really are
    </p>

    <!-- Input card -->
    <div class="relative bg-zinc-900/70 backdrop-blur
                shadow-2xl shadow-indigo-500/20
                p-6 rounded-xl
                border border-white/15
                ring-1 ring-indigo-400/20
                text-left">

        <form action="/show_roster" method="get">

            <!-- Username input -->
            <label class="block font-semibold mb-1 text-gray-300">
                Sleeper Username
            </label>
            <input
                id="username"
                name="username"
                placeholder="Enter your Sleeper username"
                required
                class="w-full h-11 px-3 mb-4
                    bg-zinc-900/60
                    border-2 border-white/50
                    rounded-lg
                    text-gray-200 placeholder-gray-500
                    focus:outline-none
                    focus:ring-2 focus:ring-indigo-400/40
                    focus:border-indigo-400/50
                    hover:border-indigo-400/40
                    transition
                    disabled:opacity-50 disabled:cursor-not-allowed">

            <!-- League selector -->
            <label class="block font-semibold mb-1 text-gray-300">
                League
            </label>
            <select
                id="leagueSelect"
                disabled
                class="w-full h-11 px-3 mb-4
                    bg-zinc-900/60
                    border-2 border-white/50
                    rounded-lg
                    text-gray-200 placeholder-gray-500
                    focus:outline-none
                    focus:ring-2 focus:ring-indigo-400/40
                    focus:border-indigo-400/50
                    hover:border-indigo-400/40
                    transition
                    disabled:opacity-50 disabled:cursor-not-allowed">
                <option>Select a league</option>
            </select>

            <!-- Season selector -->
            <label class="block font-semibold mb-1 text-gray-300">
                Season
            </label>
            <select
                id="seasonSelect"
                name="league_id"
                disabled
                class="w-full h-11 px-3 mb-4
                    bg-zinc-900/60
                    border-2 border-white/50
                    rounded-lg
                    text-gray-200 placeholder-gray-500
                    focus:outline-none
                    focus:ring-2 focus:ring-indigo-400/40
                    focus:border-indigo-400/50
                    hover:border-indigo-400/40
                    transition
                    disabled:opacity-50 disabled:cursor-not-allowed">
                <option>Select a season</option>
            </select>

            <!-- Centered button -->
            <div class="flex justify-center">
                <button
                    type="submit"
                    class="relative bg-indigo-600 hover:bg-indigo-500
                           text-white font-semibold
                           py-2 px-8 rounded-lg
                           shadow-lg shadow-indigo-500/40
                           hover:shadow-indigo-500/50
                           hover:-translate-y-0.5
                           transition-all duration-200
                           disabled:opacity-50">
                    View Roster
                </button>
            </div>

        </form>
    </div>
</div>


<!-- Loading overlay displayed while roster page is loading -->
<div id="loadingOverlayRoster"
     class="hidden fixed inset-0 bg-black bg-opacity-60 flex flex-col items-center justify-center z-50">
    
    <!-- Spinner -->
    <svg class="animate-spin h-12 w-12 text-indigo-400 mb-4"
         xmlns="http://www.w3.org/2000/svg" fill="none" 
         viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10"
                stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
    </svg>

    <p class="text-indigo-300 text-lg font-semibold">
        Loading roster... please wait
    </p>
</div>


<!-- Loading overlay displayed while leagues are being fetched -->
<div id="loadingOverlayLeagues"
     class="hidden fixed inset-0 bg-black bg-opacity-50 flex flex-col items-center justify-center z-40">

    <!-- Smaller spinner -->
    <svg class="animate-spin h-10 w-10 text-indigo-300 mb-3"
         xmlns="http://www.w3.org/2000/svg" fill="none" 
         viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10"
                stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
    </svg>

    <p class="text-indigo-200 font-medium">
        Loading leagues...
    </p>
</div>


<script>
/*
    Frontend logic for:
    - Fetching leagues for a username
    - Populating league and season dropdowns
    - Managing loading states
*/

// Input and select elements
const usernameInput = document.getElementById("username");
const leagueSelect  = document.getElementById("leagueSelect");
const seasonSelect  = document.getElementById("seasonSelect");

// Loading overlays
const loadingOverlayRoster  = document.getElementById("loadingOverlayRoster");
const loadingOverlayLeagues = document.getElementById("loadingOverlayLeagues");

// Main form element
const form = document.querySelector("form");

// Show roster loading spinner on form submission
form.addEventListener("submit", () => {
    loadingOverlayRoster.classList.remove("hidden");
});

// Holds league data returned from the backend
let leagueData = {};

// Fetch leagues when a username is entered
async function loadLeagues(username) {
    // Show league-loading overlay
    loadingOverlayLeagues.classList.remove("hidden");

    // Reset dropdowns while loading
    leagueSelect.innerHTML = "<option>Loading leagues...</option>";
    leagueSelect.disabled = true;
    seasonSelect.disabled = true;

    try {
        // Call backend endpoint to retrieve leagues
        const res = await fetch(`/user_leagues?username=${username}`);
        leagueData = await res.json();

        leagueSelect.innerHTML = "";

        // Handle invalid user
        if (leagueData.error) {
            leagueSelect.innerHTML = "<option>User not found</option>";
            loadingOverlayLeagues.classList.add("hidden");
            return;
        }

        // Populate league dropdown with league names
        for (const leagueName in leagueData) {
            const opt = document.createElement("option");
            opt.value = leagueName;
            opt.textContent = leagueName;
            leagueSelect.appendChild(opt);
        }

        // Enable league selector and trigger initial season population
        leagueSelect.disabled = false;
        leagueSelect.dispatchEvent(new Event("change"));

    } catch (err) {
        leagueSelect.innerHTML = "<option>Error loading leagues</option>";
    }

    // Hide league-loading overlay
    loadingOverlayLeagues.classList.add("hidden");
}

// Populate seasons when a league is selected
leagueSelect.addEventListener("change", () => {
    seasonSelect.innerHTML = "";

    const selectedLeague = leagueSelect.value;
    const seasons = leagueData[selectedLeague] || [];

    // Each season option submits a league_id
    seasons.forEach(l => {
        const opt = document.createElement("option");
        opt.value = l.league_id;
        opt.textContent = l.season;
        seasonSelect.appendChild(opt);
    });

    seasonSelect.disabled = false;
});

// Trigger league loading when user leaves the username field
usernameInput.addEventListener("blur", () => {
    if (usernameInput.value.trim()) {
        loadLeagues(usernameInput.value.trim());
    }
});
</script>

</body>
</html>
